(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bd4f0f6a"],{1424:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-content",[i("v-img",{staticClass:"bdBackground",attrs:{src:s("775a"),height:"100%",width:"100%"}}),i("v-container",[i("v-row",[i("v-col",[i("v-card",{attrs:{width:"100%",height:"500px",color:"#FFFDE7",tile:""}},[i("v-row",{staticClass:"ma-0"},[i("v-col",{staticClass:"pa-0",attrs:{cols:"3"}},[i("v-list",{staticClass:"pa-0",attrs:{color:"#FFFDE7"}},[i("v-list-item-group",[e._l(e.history,(function(t,s){return i("v-hover",{key:t.sid,scopedSlots:e._u([{key:"default",fn:function(r){var n=r.hover;return[i("v-list-item",{on:{click:function(t){return e.switchMessages(s)}}},[[i("v-list-item-avatar",[i("v-img",{attrs:{src:"http://fs.budingcc.cn:8888/group1/M00/00/00/dU4Lkl5OjIeAG6SWAABMN7CE7-U017.jpg"}})],1),i("v-list-item-content",[i("v-list-item-title",[e._v(e._s(t.nickName))])],1),0!=t.unread?i("v-avatar",{attrs:{color:"red",size:"20"}},[i("span",{staticClass:"white--text"},[e._v(e._s(t.unread))])]):e._e(),n&&0!=s?i("v-icon",{on:{click:function(s){return s.stopPropagation(),e.closeHistory(t.sid)}}},[e._v("mdi-close")]):e._e()]],2)]}}],null,!0)})}))],2)],1)],1),i("v-col",{staticStyle:{height:"500px"}},[i("v-card",{attrs:{height:"100%"}},[i("v-card-title",[e._v(e._s(e.history[e.currentMessageIndex].nickName))]),i("v-divider"),i("v-card-text",{staticClass:"chat_box",staticStyle:{height:"78%",overflow:"auto"}},e._l(e.history[e.currentMessageIndex].messages,(function(t,s){return i("v-list-item",{key:s},[i("v-list-item-avatar",{directives:[{name:"show",rawName:"v-show",value:t.send_user_id!=e.user.sid,expression:"message.send_user_id!=user.sid"}]},[i("v-img",{attrs:{src:e.history[e.currentMessageIndex].profile_photo}})],1),i("v-list-item-content",[i("v-list-item-title",{class:{"text-right":t.send_user_id==e.user.sid}},[e._v(e._s(t.message_content))])],1),i("v-list-item-avatar",{directives:[{name:"show",rawName:"v-show",value:t.send_user_id==e.user.sid,expression:"message.send_user_id==user.sid"}]},[i("v-img",{attrs:{src:e.user.profile_photo}})],1)],1)})),1),i("v-divider"),i("v-text-field",{attrs:{placeholder:"ENTER发送消息",solo:""},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage(t)}},scopedSlots:e._u([{key:"append",fn:function(){return[i("v-btn",{attrs:{color:"success"},on:{click:e.sendMessage}},[e._v("发送")])]},proxy:!0}]),model:{value:e.message.message_content,callback:function(t){e.$set(e.message,"message_content","string"===typeof t?t.trim():t)},expression:"message.message_content"}})],1)],1)],1)],1)],1)],1)],1)],1)},r=[],n=(s("b64b"),s("4328")),a=s.n(n),o=s("2b0e"),c={name:"chat",created:function(){},mounted:function(){},watch:{currentMessageIndex:function(){var e=this;setTimeout((function(){e.scrollToBottom()}),30)}},data:function(){return{user:{nickName:"Ikaros"},currentMessageIndex:0,message:{message_id:null,message_content:null,message_time:null,send_user_id:null,receive_user_id:this.$route.params.user_id?this.$route.params.user_id:0,message_read:null},history:[{nickName:"杨佩斯"}]}},sockets:{receiveMessage:function(e){var t=this,s=this;if(this.history[e.send_user_id]){this.history[e.send_user_id].messages||(this.history[e.send_user_id].messages=[]);e.message_id;delete this.history[e.send_user_id].messages[void 0];var i=Object.keys(this.history[e.send_user_id].messages).length;o["a"].set(this.history[e.send_user_id].messages,i,e),e.send_user_id!=this.currentMessageIndex&&(this.history[e.send_user_id].unread=parseInt(this.history[e.send_user_id].unread)+1)}else this.$axios({method:"get",url:"/user/profile/"+e.send_user_id}).then((function(t){o["a"].set(s.history,e.send_user_id,{sid:e.send_user_id,nickname:t.data.nick_name,profile_photo:t.data.profile_photo,messages:[e],unread:1})})).catch((function(e){}));setTimeout((function(){t.scrollToBottom()}),30)},sent:function(e){var t=this,s=this.history[this.currentMessageIndex];s.messages||(s.messages=[]),o["a"].set(s.messages,s.messages.length,e),this.message.message_content="",setTimeout((function(){t.scrollToBottom()}),30)}},beforeDestroy:function(){this.recordHistory()},destroyed:function(){var e=this;window.removeEventListener("beforeunload",(function(t){return e.beforeunloadFn(t)}))},methods:{closeHistory:function(e){this.currentMessageIndex=0,o["a"].delete(this.history,e)},beforeunloadFn:function(e){this.recordHistory()},recordHistory:function(){localStorage.setItem("history-"+this.user.sid,a.a.stringify(this.history))},sendMessage:function(){null!=this.message.message_content&&""!=this.message.message_content&&this.$socket.emit("sendMessage",this.message)},switchMessages:function(e){this.currentMessageIndex=e,this.message.receive_user_id=this.history[this.currentMessageIndex].sid,this.resetSetItem("unRead",parseInt(sessionStorage.getItem("unRead"))-this.history[e].unread),this.history[e].unread=0},scrollToBottom:function(){var e=this.$el.querySelector(".chat_box");e&&(e.scrollTop=e.scrollHeight)}}},d=c,u=(s("ebd1"),s("2877")),l=s("6544"),h=s.n(l),v=s("8212"),m=s("8336"),f=s("b0af"),g=s("99d9"),_=s("62ad"),p=s("a523"),y=s("a75b"),b=s("ce7e"),w=s("ce87"),x=s("132d"),k=s("adda"),I=s("8860"),O=s("da13"),M=s("8270"),T=s("5d23"),V=s("1baa"),j=s("0fd9"),S=s("8654"),C=Object(u["a"])(d,i,r,!1,null,null,null);t["default"]=C.exports;h()(C,{VAvatar:v["a"],VBtn:m["a"],VCard:f["a"],VCardText:g["b"],VCardTitle:g["c"],VCol:_["a"],VContainer:p["a"],VContent:y["a"],VDivider:b["a"],VHover:w["a"],VIcon:x["a"],VImg:k["a"],VList:I["a"],VListItem:O["a"],VListItemAvatar:M["a"],VListItemContent:T["a"],VListItemGroup:V["a"],VListItemTitle:T["b"],VRow:j["a"],VTextField:S["a"]})},"16b7":function(e,t,s){"use strict";s("a9e3");var i=s("2b0e");t["a"]=i["a"].extend().extend({name:"delayable",props:{openDelay:{type:[Number,String],default:0},closeDelay:{type:[Number,String],default:0}},data:function(){return{openTimeout:void 0,closeTimeout:void 0}},methods:{clearDelay:function(){clearTimeout(this.openTimeout),clearTimeout(this.closeTimeout)},runDelay:function(e,t){var s=this;this.clearDelay();var i=parseInt(this["".concat(e,"Delay")],10);this["".concat(e,"Timeout")]=setTimeout(t||function(){s.isActive={open:!0,close:!1}[e]},i)}}})},"565b":function(e,t,s){},"8ce9":function(e,t,s){},ce7e:function(e,t,s){"use strict";s("a4d3"),s("4de4"),s("4160"),s("e439"),s("dbb4"),s("b64b"),s("159b");var i=s("ade3"),r=(s("8ce9"),s("7560"));function n(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function a(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach((function(t){Object(i["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}t["a"]=r["a"].extend({name:"v-divider",props:{inset:Boolean,vertical:Boolean},render:function(e){var t;return this.$attrs.role&&"separator"!==this.$attrs.role||(t=this.vertical?"vertical":"horizontal"),e("hr",{class:a({"v-divider":!0,"v-divider--inset":this.inset,"v-divider--vertical":this.vertical},this.themeClasses),attrs:a({role:"separator","aria-orientation":t},this.$attrs),on:this.$listeners})}})},ce87:function(e,t,s){"use strict";var i=s("16b7"),r=s("f2e7"),n=s("58df"),a=s("d9bd");t["a"]=Object(n["a"])(i["a"],r["a"]).extend({name:"v-hover",props:{disabled:{type:Boolean,default:!1},value:{type:Boolean,default:void 0}},methods:{onMouseEnter:function(){this.runDelay("open")},onMouseLeave:function(){this.runDelay("close")}},render:function(){return this.$scopedSlots.default||void 0!==this.value?(this.$scopedSlots.default&&(e=this.$scopedSlots.default({hover:this.isActive})),Array.isArray(e)&&1===e.length&&(e=e[0]),e&&!Array.isArray(e)&&e.tag?(this.disabled||(e.data=e.data||{},this._g(e.data,{mouseenter:this.onMouseEnter,mouseleave:this.onMouseLeave})),e):(Object(a["c"])("v-hover should only contain a single element",this),e)):(Object(a["c"])("v-hover is missing a default scopedSlot or bound value",this),null);var e}})},ebd1:function(e,t,s){"use strict";var i=s("565b"),r=s.n(i);r.a}}]);
//# sourceMappingURL=chunk-bd4f0f6a.a228e3e3.js.map