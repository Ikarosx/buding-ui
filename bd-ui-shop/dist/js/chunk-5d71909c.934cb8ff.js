(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d71909c"],{"0fae":function(e,t,o){},bdab:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-main",[e.update?e._e():r("v-img",{staticClass:"bdBackground",attrs:{src:o("775a"),height:"100%",width:"100%"}}),r("v-container",[r("v-row",{attrs:{justify:"center"}},[r("v-col",[r("v-card",[r("v-card-text",[r("v-card-title",[e._v(e._s(e.update?"修改商品":"发布商品"))]),r("v-form",{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[r("v-text-field",{attrs:{counter:20,rules:[e.rules.required,e.rules.notSpecial],label:"商品名称","prepend-icon":"mdi-pig-variant",required:""},model:{value:e.good.goodName,callback:function(t){e.$set(e.good,"goodName",t)},expression:"good.goodName"}}),r("v-icon",[e._v("mdi-file-tree")]),r("el-cascader",{attrs:{options:e.category.categoryList,placeholder:"请选择分类",props:e.category.props},model:{value:e.category.categoryActive,callback:function(t){e.$set(e.category,"categoryActive",t)},expression:"category.categoryActive"}}),r("v-textarea",{attrs:{label:"商品描述","prepend-icon":"mdi-note",rules:[e.rules.required]},model:{value:e.good.description,callback:function(t){e.$set(e.good,"description",t)},expression:"good.description"}}),r("v-text-field",{attrs:{rules:[e.rules.required,e.rules.numical],label:"商品价格","prepend-icon":"mdi-cash-usd",required:""},model:{value:e.good.price,callback:function(t){e.$set(e.good,"price",t)},expression:"good.price"}}),r("v-icon",[e._v("mdi-camera")]),r("v-btn",{attrs:{color:"#FFD600",small:""},on:{click:function(t){e.crop.show=!e.crop.show}}},[e._v("上传图片")]),e.crop.list.length>0?r("v-list",e._l(e.crop.list,(function(t){return r("v-list-item",{key:t},[r("v-list-item-content",[r("v-img",{attrs:{src:"http://fdfs.ikarosx.cn:8888/"+t,"max-width":"480"}})],1),r("v-list-item-action",[r("v-btn",{attrs:{icon:""},on:{click:function(o){return e.deleteFile(t)}}},[r("v-icon",{attrs:{color:"grey lighten-1"}},[e._v("mdi-close")])],1)],1)],1)})),1):e._e()],1)],1),r("v-card-actions",[r("div",{staticClass:"flex-grow-1"}),r("v-btn",{attrs:{color:"#FFD600"},on:{click:e.insertGood}},[e._v("发布")])],1)],1)],1)],1),r("image-upload",{attrs:{field:"file",width:480,height:270,url:"http://gateway.budingcc.cn:30000/api/filesystem/upload",params:e.crop.params,headers:e.crop.headers,"img-format":"png",langExt:e.crop.langExt,noCircle:!0,noSquare:!1},on:{"src-file-set":e.srcFileSet,"crop-success":e.cropSuccess,"crop-upload-success":e.cropUploadSuccess,"crop-upload-fail":e.cropUploadFail},model:{value:e.crop.show,callback:function(t){e.$set(e.crop,"show",t)},expression:"crop.show"}})],1)],1)},a=[],c=(o("4de4"),o("ac1f"),o("1276"),o("4328")),i=o.n(c),s=o("5c96"),n=(o("0fae"),o("0b4d")),l=o("c698"),d={components:{"el-cascader":s["Cascader"],"image-upload":n["a"]},created:function(){this.loadGoodCategory(),this.changeGood()},name:"good",watch:{good:function(){this.changeGood()}},props:{update:{type:Boolean,default:!1},title:{type:String,default:"发布商品"},good:{type:Object,default:function(){return{goodName:"",description:"",directCategoryId:"",price:"",imageUrl:"",userId:"8a80cb81704365b5017043674de40006",username:"",schoolId:"1"}}}},computed:{},data:function(){return{category:{categoryList:[],categoryActive:[],props:{expandTrigger:"hover",value:"id",label:"name",children:"children",checkStrictly:!1}},crop:{show:!1,params:{businessKey:"goodImage",fileName:"fileName"},headers:{smail:"*_~",Authorization:"Bearer "+localStorage.getItem("access_token")},langExt:{preview:"图片预览"},list:[]},valid:"",rules:{required:function(e){return!!e||"不能为空"},notSpecial:function(e){return/^[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(e)||"只能包含字母、数字或中文"},numical:function(e){return/^[0-9]{1}[0-9]*[.]?[0-9]*$/.test(e)||"价格格式错误"}}}},methods:{srcFileSet:function(e,t,o){this.crop.params.fileName=e},changeGood:function(){var e=this.good.imageUrl;e&&""!=e&&(this.crop.list=e.split(","));var t=this.good.directCategoryId;t&&""!=t&&(this.category.categoryActive=this.convertCategoryActive(t))},convertCategoryActive:function(e){for(var t=e.split("-"),o=1;o<t.length;o++)t[o]=t[o-1]+"-"+t[o];return t},cropSuccess:function(e,t){console.log("crop~~啦啦啦")},cropUploadSuccess:function(e,t){var o=i.a.parse(e);console.log(o),o.success?(this.$message.success("上传图片成功"),this.crop.list.push(o.data.path),this.crop.show=!1):(this.$message.error(o.message),this.crop.show=!1)},cropUploadFail:function(e,t){this.$message.error("上传图片失败")},loadGoodCategory:function(){var e=this;l["d"]().then((function(t){t.success?e.category.categoryList=e.handleLeaf(t.queryResult.list):e.$message.error(t.message)})).catch((function(t){e.$message.error(t.message)}))},deleteFile:function(e){this.crop.list=this.crop.list.filter((function(t){return t!=e}))},insertGood:function(){var e=this;this.$refs.form.validate()&&(!this.category.categoryActive||this.category.categoryActive.length<=1?this.$message.error("请选择商品分类，还有不要选择根节点da"):this.crop.list&&0!=this.crop.list.length?(this.good.imageUrl=this.convertImgUrl(),this.good.directCategoryId=this.convertDirectCategoryId(),this.good.rootCategoryId=this.category.categoryActive[1],l["c"](this.good).then((function(t){t.success?(e.$message.success("发布商品成功，请等待1-2分钟后台处理"),e.crop.list=[],e.$refs["form"].reset()):e.$message.error(t.message)})).catch((function(t){e.$message.error(t.message)}))):this.$message.error("请上传图片"))},convertDirectCategoryId:function(){var e=this.category.categoryActive.length;return this.category.categoryActive[e-1]},convertImgUrl:function(){var e="";for(var t in this.crop.list){var o=this.crop.list[t];o&&""!=o&&(e+=this.crop.list[t]+",")}return e=e.substring(0,e.length-1),e},handleLeaf:function(e){for(var t=0;t<e.length;t++)!e[t].children||e[t].children.length<1?e[t].children=void 0:this.handleLeaf(e[t].children);return e}}},u=d,g=o("2877"),p=o("6544"),h=o.n(p),f=o("8336"),v=o("b0af"),m=o("99d9"),y=o("62ad"),b=o("a523"),w=o("4bd4"),C=o("132d"),x=o("adda"),$=o("8860"),V=o("da13"),k=o("1800"),A=o("5d23"),I=o("f6c4"),_=o("0fd9"),q=o("8654"),F=o("a844"),S=Object(g["a"])(u,r,a,!1,null,null,null);t["default"]=S.exports;h()(S,{VBtn:f["a"],VCard:v["a"],VCardActions:m["a"],VCardText:m["b"],VCardTitle:m["c"],VCol:y["a"],VContainer:b["a"],VForm:w["a"],VIcon:C["a"],VImg:x["a"],VList:$["a"],VListItem:V["a"],VListItemAction:k["a"],VListItemContent:A["a"],VMain:I["a"],VRow:_["a"],VTextField:q["a"],VTextarea:F["a"]})},c698:function(e,t,o){"use strict";o.d(t,"d",(function(){return n})),o.d(t,"e",(function(){return l})),o.d(t,"c",(function(){return d})),o.d(t,"a",(function(){return u})),o.d(t,"b",(function(){return g}));var r=o("1797"),a=o("b383"),c=o.n(a),i=o("6941"),s=i["systemConfig"].gatewayApiUrl,n=function(){return r["a"].requestGet(s+"/api/shop/category/struct")},l=function(e,t,o){var a=c.a.stringify(o);return r["a"].requestGet(s+"/api/es/good/list/"+e+"/"+t+"?time="+(new Date).valueOf()+"&"+a)},d=function(e){return r["a"].requestPost(s+"/api/shop/good",e)},u=function(e){return r["a"].requestDelete(s+"/api/shop/good/"+e)},g=function(e){return r["a"].requestDelete(s+"/api/shop/good/list/"+e)}}}]);
//# sourceMappingURL=chunk-5d71909c.934cb8ff.js.map